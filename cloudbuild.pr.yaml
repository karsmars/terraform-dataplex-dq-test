steps:
  - name: 'hashicorp/terraform:light'
    entrypoint: sh
    args:
      - -c
      - |
        terraform init
        terraform plan -no-color -detailed-exitcode
        code=$?
        if [ $code -eq 1 ]; then
          echo "❌ terraform plan failed"
          exit 1
        elif [ $code -eq 2 ]; then
          echo "⚠️ terraform plan succeeded - changes detected" 
        else
          echo "✅ terraform plan succeeded"
        fi

options:
  logging: CLOUD_LOGGING_ONLY
